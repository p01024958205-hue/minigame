<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>터치 로그라이크 : 생존 구역</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#111;color:#fff;font-family:sans-serif}
#game{position:relative;width:100vw;height:100vh;background:#222}
.player,.enemy,.projectile,.skill{position:absolute;transform:translate(-50%,-50%)}
.player{width:40px;height:40px;border-radius:8px;background:#4af}
.enemy{width:40px;height:40px;background:#a33;border-radius:50%}
#ui{position:fixed;top:10px;left:10px;z-index:10}
#levelUp{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;justify-content:center;align-items:center;gap:20px;z-index:20}
#levelUp button{width:220px;padding:15px;font-size:16px}
</style>
</head>
<body>
<div id="game"></div>
<div id="ui"></div>
<div id="levelUp"></div>
<script>
const game=document.getElementById('game');
const levelUpUI=document.getElementById('levelUp');

const player={
  class:'warrior', // warrior, soldier, mage
  weapon:'katana',
  x:window.innerWidth/2,
  y:window.innerHeight/2,
  stats:{hp:120,maxHp:120,damage:10,atkSpeed:1},
  lastAttack:0,
  skills:[]
};

const playerEl=document.createElement('div');
playerEl.className='player';
game.appendChild(playerEl);

const enemies=[];
const projectiles=[];

const skillDefs={
  warrior:{
    katana:[
      {name:'초승달 베기',cd:3000,cast:()=>slash(80,1.5)},
      {name:'질풍참',cd:6000,cast:()=>slash(120,2)}
    ],
    axe:[
      {name:'회전 도끼',cd:4000,cast:()=>aoe(90,1.8)},
      {name:'대지 분쇄',cd:7000,cast:()=>aoe(140,2.5)}
    ],
    greatsword:[
      {name:'중력 참격',cd:5000,cast:()=>slash(150,3)}
    ]
  },
  soldier:{
    pistol:[
      {name:'쌍권총 연사',cd:3000,cast:()=>shoot(3,6)}
    ],
    rifle:[
      {name:'돌격사격',cd:5000,cast:()=>shoot(6,8)}
    ],
    sniper:[
      {name:'관통 저격',cd:6000,cast:()=>shoot(1,20,true)}
    ]
  },
  mage:{
    fire:[
      {name:'화염구',cd:3000,cast:()=>shoot(1,10,false,'orange')}
    ],
    ice:[
      {name:'빙결파',cd:5000,cast:()=>aoe(100,1.5,'#7af')}
    ],
    lightning:[
      {name:'연쇄 번개',cd:6000,cast:()=>chain()}
    ]
  }
};

function slash(range,mult){
  enemies.forEach(e=>{
    const d=Math.hypot(e.x-player.x,e.y-player.y);
    if(d<range) e.hp-=player.stats.damage*mult;
  });
}
function aoe(range,mult,color='#fa0'){
  enemies.forEach(e=>{
    const d=Math.hypot(e.x-player.x,e.y-player.y);
    if(d<range) e.hp-=player.stats.damage*mult;
  });
}
function shoot(count,speed,pierce=false,color='#ff0'){
  for(let i=0;i<count;i++){
    projectiles.push({x:player.x,y:player.y,dx:Math.cos(i)*speed,dy:Math.sin(i)*speed,damage:player.stats.damage,pierce,color});
  }
}
function chain(){
  let last=null;
  enemies.slice(0,3).forEach(e=>{if(last)e.hp-=player.stats.damage*1.5;last=e;});
}

function autoAttack(){
  const now=Date.now();
  if(now-player.lastAttack<1000/player.stats.atkSpeed) return;
  player.lastAttack=now;
  if(enemies[0]) enemies[0].hp-=player.stats.damage;
}

function spawnEnemy(){
  enemies.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,hp:30});
}

function update(){
  autoAttack();
  enemies.forEach((e,i)=>{if(e.hp<=0) enemies.splice(i,1);});
  projectiles.forEach(p=>{p.x+=p.dx;p.y+=p.dy;});
  render();
  requestAnimationFrame(update);
}

function render(){
  playerEl.style.left=player.x+'px';
  playerEl.style.top=player.y+'px';
  document.querySelectorAll('.enemy,.projectile').forEach(el=>el.remove());
  enemies.forEach(e=>{
    const el=document.createElement('div');
    el.className='enemy';
    el.style.left=e.x+'px';
    el.style.top=e.y+'px';
    game.appendChild(el);
  });
}

setInterval(spawnEnemy,2000);
update();
</script>
</body>
</html>
