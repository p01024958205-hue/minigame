<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Glass Orchard â€” DODGE EXTREME</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
html,body{margin:0;padding:0;background:#05070c;color:#e6e6eb;font-family:system-ui;touch-action:none}
canvas{display:block;margin:0 auto;background:#070a12}
#hud{position:fixed;top:0;left:0;width:100%;display:flex;justify-content:space-between;padding:6px;z-index:5}
.chip{background:rgba(20,30,70,.7);border-radius:10px;padding:6px 10px;font-size:12px}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:10}
#panel{background:#0f163a;border-radius:16px;padding:20px;width:88%;max-width:380px;text-align:center}
button{background:#23318c;border:1px solid #3a4bdc;color:#fff;border-radius:12px;padding:10px 16px;margin-top:10px}
</style>
</head>
<body>
  <!-- Intro Story Overlay -->
  <div id="intro" style="position:fixed; inset:0; background:#0b0b0f; color:#e6e6f0; z-index:10; overflow:hidden;">
  <div id="storyScroll" style="position:absolute; bottom:-100%; width:100%; padding:32px 24px; box-sizing:border-box; text-align:center;">
    <h1 style="margin-bottom:24px;">ðŸŒ¿ Glass Orchard</h1>
    <p id="introText" style="max-width:520px; margin:0 auto; line-height:1.8; font-size:15px; white-space:pre-line;"></p>
  </div>

  <button onclick="skipIntro()" style="position:absolute; top:16px; right:16px; padding:8px 14px; font-size:13px; opacity:0.75;">SKIP</button>
</div>
  </div>

  <canvas id="game"></canvas>

  <script>
    const intro = document.getElementById('intro');

// ì¸íŠ¸ë¡œ ë¬¸êµ¬ ë¶„ê¸°
const unlocked = JSON.parse(localStorage.getItem('endings')||'{}');
let introStory = `ìœ ë¦¬ëŠ” í•˜ëŠ˜ì—ì„œ ë–¨ì–´ì¡Œë‹¤.

ì²˜ìŒì—ëŠ” ë¹„ì²˜ëŸ¼ ë³´ì˜€ë‹¤.
ë°˜ì§ì´ê³ , ì•„ë¦„ë‹µê³ , ì¡°ìš©ížˆ.

ê·¸ëŸ¬ë‚˜ ê·¸ê²ƒì€ ë¹„ê°€ ì•„ë‹ˆì—ˆë‹¤.

ì´ ì„¸ê³„ì—ì„œ ì‚´ì•„ë‚¨ëŠ” ë²•ì€ ë‹¨ í•˜ë‚˜.
ë§žì§€ ì•ŠëŠ” ê²ƒ.`;

if(unlocked.seed){
  introStory += `

ì”¨ì•—ì€ ê¸°ì–µí•œë‹¤.`;
}
if(unlocked.true){
  introStory += `

ì •ì›ì€ ë„ˆë¥¼ ì•Œê³  ìžˆë‹¤.`;
}
if(unlocked.hidden){
  introStory += `

ìœ ë¦¬ëŠ” ë” ì´ìƒ ì ì´ ì•„ë‹ˆë‹¤.`;
}

document.getElementById('introText').innerText = introStory;
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = 390;
      canvas.height = 720;
    }
    resize();

    let gameStarted = false;

// ì¸íŠ¸ë¡œ ìžë™ ìŠ¤í¬ë¡¤ + ì¢…ë£Œ ê°ì§€
let scrollY = -window.innerHeight;
let introFinished = false;
function scrollStory(){
  const story = document.getElementById('storyScroll');
  scrollY += 0.25;
  story.style.bottom = scrollY + 'px';

  // ë„íŠ¸ ì¼ëŸ¬ìŠ¤íŠ¸ ë“±ìž¥
  if(scrollY > -200) drawIntroSeed();

  if(scrollY < 80) {
    requestAnimationFrame(scrollStory);
  } else if(!introFinished) {
    introFinished = true;
    fadeOutIntro();
  }
}
scrollStory();

function fadeOutIntro(){
  let opacity = 1;
  const fade = setInterval(()=>{
    opacity -= 0.02;
    intro.style.opacity = opacity;
    if(opacity <= 0){
      clearInterval(fade);
      startGame();
    }
  },30);
}

function drawIntroSeed(){
  const seed = document.createElement('div');
  seed.style.position='absolute';
  seed.style.left='50%';
  seed.style.top='60%';
  seed.style.width='8px';
  seed.style.height='8px';
  seed.style.background='#9cff57';
  seed.style.transform='translate(-50%,-50%)';
  seed.style.boxShadow='0 0 8px #9cff57';
  intro.appendChild(seed);
}


    function startGame() {
  intro.style.display = 'none';
  gameStarted = true;
  initGame();
  requestAnimationFrame(loop);
}

    function skipIntro() {
      startGame();
    }

    // === ê²Œìž„ ë¡œì§ í™•ìž¥ ===

let endingsUnlocked = JSON.parse(localStorage.getItem('endings')||'{}');
let currentEnding = null;

const endingTexts = {
  fail: {
    title:'âŒ íŒŒíŽ¸ ì—”ë”©',
    text:'ìœ ë¦¬ëŠ” ë¶€ì„œì¡Œê³ , ì”¨ì•—ì€ ë¿Œë¦¬ë‚´ë¦¬ì§€ ëª»í–ˆë‹¤.
ì •ì›ì€ ì•„ì§ ë„ˆë¥¼ ë°›ì•„ë“¤ì´ì§€ ì•ŠëŠ”ë‹¤.'
  },
  seed: {
    title:'ðŸŒ± ì”¨ì•— ì—”ë”©',
    text:'ìž‘ì€ ì”¨ì•— í•˜ë‚˜ê°€ ë‚¨ì•˜ë‹¤.
ì•„ì§ ì—°ì•½í•˜ì§€ë§Œ, ê°€ëŠ¥ì„±ì€ ì¡´ìž¬í•œë‹¤.'
  },
  true: {
    title:'ðŸ‘‘ ìœ ë¦¬ ì •ì› ì—”ë”©',
    text:'ë„ˆëŠ” ëê¹Œì§€ ë²„í…¼ë‹¤.
ì •ì›ì€ ë„ˆë¥¼ ì„ íƒí–ˆê³ , ìœ ë¦¬ëŠ” ë” ì´ìƒ ì ì´ ì•„ë‹ˆë‹¤.'
  }
};

function showEnding(type){
  currentEnding = type;
  endingsUnlocked[type] = true;
  localStorage.setItem('endings',JSON.stringify(endingsUnlocked));

  let overlay = document.createElement('div');
  overlay.style.position='fixed';overlay.style.inset=0;
  overlay.style.background='#050508';overlay.style.color='#fff';
  overlay.style.zIndex=20;overlay.style.display='flex';
  overlay.style.flexDirection='column';overlay.style.justifyContent='center';
  overlay.style.alignItems='center';overlay.style.padding='20px';

  let h=document.createElement('h2');h.innerText=endingTexts[type].title;
  let p=document.createElement('p');p.style.whiteSpace='pre-line';
  p.style.maxWidth='480px';p.style.lineHeight='1.6';

  overlay.appendChild(h);overlay.appendChild(p);

  let btn=document.createElement('button');
  btn.innerText='ë‹¤ì‹œí•˜ê¸°';btn.style.marginTop='20px';
  btn.onclick=()=>location.reload();

  let unlock=document.createElement('div');
  unlock.style.marginTop='16px';unlock.style.fontSize='13px';
  unlock.innerText='í•´ê¸ˆ í˜„í™©: '+Object.keys(endingsUnlocked).join(', ');

  overlay.appendChild(btn);
  overlay.appendChild(unlock);
  document.body.appendChild(overlay);

  typeWriter(p, endingTexts[type].text);
}

function typeWriter(el,text){
  el.innerText='';let i=0;
  let t=setInterval(()=>{
    el.innerText+=text[i++];
    if(i>=text.length) clearInterval(t);
  },40);
}

// === ë„íŠ¸ ì¼ëŸ¬ìŠ¤íŠ¸ ===
function drawSeed(x,y){
  ctx.fillStyle='#9cff57';ctx.fillRect(x-2,y-2,4,4);
  ctx.fillStyle='#3a8f2d';ctx.fillRect(x-1,y-1,2,2);
}

// === ì‚¬ë§ ì²˜ë¦¬ ì˜ˆì‹œ ===
function gameOver(time){
  if(dodgePerfect && time>60) showEnding('hidden');
  else if(time<30) showEnding('fail');
  else if(time<60) showEnding('seed');
  else showEnding('true');
}

// ê¸°ì¡´ loop ì•ˆì—ì„œ drawSeed(player.x,player.y) í˜¸ì¶œ

