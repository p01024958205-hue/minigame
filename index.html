<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>Glass Orchard â€” DODGE EXTREME</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
html,body{margin:0;padding:0;background:#05070c;color:#e6e6eb;font-family:system-ui;touch-action:none}
canvas{display:block;margin:0 auto;background:#070a12}
#hud{position:fixed;top:0;left:0;width:100%;display:flex;justify-content:space-between;padding:6px;z-index:5}
.chip{background:rgba(20,30,70,.7);border-radius:10px;padding:6px 10px;font-size:12px}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;align-items:center;justify-content:center;z-index:10}
#panel{background:#0f163a;border-radius:16px;padding:20px;width:88%;max-width:380px;text-align:center}
button{background:#23318c;border:1px solid #3a4bdc;color:#fff;border-radius:12px;padding:10px 16px;margin-top:10px}
</style>
</head>
<body>
  <!-- Intro Story Overlay -->
  <div id="intro" style="position:fixed; inset:0; background:#0b0b0f; color:#e6e6f0; z-index:10; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px; text-align:center;">
    <h1 style="margin-bottom:16px;">ğŸŒ¿ Glass Orchard</h1>
    <p style="max-width:480px; line-height:1.6; font-size:15px;">
      ìœ ë¦¬ë¡œ ëœ ì”¨ì•—ë“¤ì´ ë–¨ì–´ì§€ëŠ” ì„¸ê³„.<br/>
      ì´ê³³ì—ì„œëŠ” ê³µê²©í•  ìˆ˜ ì—†ë‹¤.<br/>
      ì‚´ì•„ë‚¨ëŠ” ìë§Œì´ ì •ì›ì˜ ì§„ì‹¤ì„ ë³¸ë‹¤.<br/><br/>
      ë„ˆëŠ” ë‹¨ í•˜ë‚˜ì˜ ì”¨ì•—.<br/>
      íŒŒí¸ì„ í”¼í•´, ëê¹Œì§€ ë²„í…¨ë¼.
    </p>
    <div style="margin-top:24px; display:flex; gap:12px;">
      <button onclick="startGame()" style="padding:10px 18px; font-size:14px;">â–¶ ì‹œì‘</button>
      <button onclick="skipIntro()" style="padding:10px 18px; font-size:14px; opacity:0.7;">SKIP</button>
    </div>
  </div>

  <canvas id="game"></canvas>

  <script>
    const intro = document.getElementById('intro');
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = 390;
      canvas.height = 720;
    }
    resize();

    let gameStarted = false;

    function startGame() {
      intro.style.display = 'none';
      gameStarted = true;
      initGame();
      requestAnimationFrame(loop);
    }

    function skipIntro() {
      startGame();
    }

    // === ê²Œì„ ë¡œì§ í™•ì¥ ===

let endingsUnlocked = JSON.parse(localStorage.getItem('endings')||'{}');
let currentEnding = null;

const endingTexts = {
  fail: {
    title:'âŒ íŒŒí¸ ì—”ë”©',
    text:'ìœ ë¦¬ëŠ” ë¶€ì„œì¡Œê³ , ì”¨ì•—ì€ ë¿Œë¦¬ë‚´ë¦¬ì§€ ëª»í–ˆë‹¤.
ì •ì›ì€ ì•„ì§ ë„ˆë¥¼ ë°›ì•„ë“¤ì´ì§€ ì•ŠëŠ”ë‹¤.'
  },
  seed: {
    title:'ğŸŒ± ì”¨ì•— ì—”ë”©',
    text:'ì‘ì€ ì”¨ì•— í•˜ë‚˜ê°€ ë‚¨ì•˜ë‹¤.
ì•„ì§ ì—°ì•½í•˜ì§€ë§Œ, ê°€ëŠ¥ì„±ì€ ì¡´ì¬í•œë‹¤.'
  },
  true: {
    title:'ğŸ‘‘ ìœ ë¦¬ ì •ì› ì—”ë”©',
    text:'ë„ˆëŠ” ëê¹Œì§€ ë²„í…¼ë‹¤.
ì •ì›ì€ ë„ˆë¥¼ ì„ íƒí–ˆê³ , ìœ ë¦¬ëŠ” ë” ì´ìƒ ì ì´ ì•„ë‹ˆë‹¤.'
  }
};

function showEnding(type){
  currentEnding = type;
  endingsUnlocked[type] = true;
  localStorage.setItem('endings',JSON.stringify(endingsUnlocked));

  let overlay = document.createElement('div');
  overlay.style.position='fixed';overlay.style.inset=0;
  overlay.style.background='#050508';overlay.style.color='#fff';
  overlay.style.zIndex=20;overlay.style.display='flex';
  overlay.style.flexDirection='column';overlay.style.justifyContent='center';
  overlay.style.alignItems='center';overlay.style.padding='20px';

  let h=document.createElement('h2');h.innerText=endingTexts[type].title;
  let p=document.createElement('p');p.style.whiteSpace='pre-line';
  p.style.maxWidth='480px';p.style.lineHeight='1.6';

  overlay.appendChild(h);overlay.appendChild(p);

  let btn=document.createElement('button');
  btn.innerText='ë‹¤ì‹œí•˜ê¸°';btn.style.marginTop='20px';
  btn.onclick=()=>location.reload();

  let unlock=document.createElement('div');
  unlock.style.marginTop='16px';unlock.style.fontSize='13px';
  unlock.innerText='í•´ê¸ˆ í˜„í™©: '+Object.keys(endingsUnlocked).join(', ');

  overlay.appendChild(btn);
  overlay.appendChild(unlock);
  document.body.appendChild(overlay);

  typeWriter(p, endingTexts[type].text);
}

function typeWriter(el,text){
  el.innerText='';let i=0;
  let t=setInterval(()=>{
    el.innerText+=text[i++];
    if(i>=text.length) clearInterval(t);
  },40);
}

// === ë„íŠ¸ ì¼ëŸ¬ìŠ¤íŠ¸ ===
function drawSeed(x,y){
  ctx.fillStyle='#9cff57';ctx.fillRect(x-2,y-2,4,4);
  ctx.fillStyle='#3a8f2d';ctx.fillRect(x-1,y-1,2,2);
}

// === ì‚¬ë§ ì²˜ë¦¬ ì˜ˆì‹œ ===
function gameOver(time){
  if(time<30) showEnding('fail');
  else if(time<60) showEnding('seed');
  else showEnding('true');
}

// ê¸°ì¡´ loop ì•ˆì—ì„œ drawSeed(player.x,player.y) í˜¸ì¶œ

